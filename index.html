<script>
  // Existing user data stored in localStorage as 'users'
  let users = JSON.parse(localStorage.getItem("users") || "{}");

  const form = document.getElementById("form");
  const loginBtn = document.getElementById("loginBtn");
  const signupBtn = document.getElementById("signupBtn");
  const message = document.getElementById("message");
  const usernameInput = document.getElementById("username");
  const passwordInput = document.getElementById("password");

  let mode = "login"; // or "signup"

  function clearInputs() {
    usernameInput.value = "";
    passwordInput.value = "";
  }

  function showMessage(text, color = "red") {
    message.style.color = color;
    message.textContent = text;
  }

  loginBtn.addEventListener("click", e => {
    e.preventDefault();
    mode = "login";
    showMessage("");
  });

  signupBtn.addEventListener("click", e => {
    e.preventDefault();
    mode = "signup";
    showMessage("");
  });

  form.addEventListener("submit", e => {
    e.preventDefault();
    const username = usernameInput.value.trim();
    const password = passwordInput.value.trim();

    // Basic validation
    if (username.length < 3) {
      showMessage("Username must be at least 3 characters");
      return;
    }
    if (password.length < 6) {
      showMessage("Password must be at least 6 characters");
      return;
    }

    if (mode === "signup") {
      if (users[username]) {
        showMessage("Username already exists");
        return;
      }
      users[username] = password;
      localStorage.setItem("users", JSON.stringify(users));
      showMessage("Signup successful! You can now login.", "green");
      clearInputs();
      mode = "login";
      return;
    }

    if (mode === "login") {
      if (!users[username]) {
        showMessage("User not found. Please sign up first.");
        return;
      }
      if (users[username] !== password) {
        showMessage("Incorrect password.");
        return;
      }
      // Login success!
      localStorage.setItem("currentUser", username);
      clearInputs();
      window.location.href = "dashboard.html"; // redirect to dashboard
    }
  });
</script>
